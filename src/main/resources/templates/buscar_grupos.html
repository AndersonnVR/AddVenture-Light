<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    th:replace="~{fragments/layout :: layout(~{::title}, ~{::link}, 'buscar-grupos', ~{::main},~{::script})}">

<head>
    <title>AddVenture - Buscar Grupos</title>
    <link rel="stylesheet" th:href="@{/css/buscar-grupos.css}">
</head>

<body>
    <main class="py-4 py-md-5">
        <div class="container">
            <!-- Hero para crear nuevo grupo -->
            <div class="card mb-4 border-0 rounded-4 overflow-hidden shadow-lg">
                <div class="position-relative">
                    <div class="overlay-gradient"></div>
                    <img th:src="@{/img/aventurero.jpg}" alt="Grupo de viajeros"
                        class="img-cover card-img w-100 object-cover" style="height: 300px;">
                    <div class="card-img-overlay d-flex flex-column justify-content-center text-white p-4 p-md-5">
                        <h1 class="display-5 fw-bold mb-3">¿No encuentras el grupo perfecto para ti?</h1>
                        <p class="lead mb-4 text-light">Crea tu propio grupo de viaje, define el destino, las fechas y
                            encuentra compañeros con tus mismos intereses.</p>
                        <div>
                            <a th:href="@{/crear-grupo}" class="btn btn-light btn-lg text-primary">
                                <i class="bi bi-plus-circle me-2"></i>Crear nuevo grupo
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <h2 class="fw-bold mb-4">Buscar Grupos de Viaje</h2>

            <!-- Filtros unificados -->
            <div class="card mb-4 border-light shadow-sm">
                <div class="card-body p-4">
                    <ul class="nav nav-tabs mb-4" id="searchTabs" role="tablist">
                        <li class="nav-item flex-fill text-center" role="presentation">
                            <button class="nav-link active w-100" id="quick-search-tab" data-bs-toggle="tab"
                                data-bs-target="#quick-search" type="button" role="tab">Búsqueda rápida</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="searchTabsContent">
                        <!-- Búsqueda rápida -->
                        <div class="tab-pane fade show active" id="quick-search" role="tabpanel">
                            <form th:action="@{/buscar-grupos}" class="row g-3 mb-4">
                                <div class="col-md-3">
                                    <label for="destino" class="form-label">¿A dónde quieres ir?</label>
                                    <input type="text" class="form-control form-control-lg" id="destino"
                                        name="destinoPrincipal" placeholder="Ej: Perú">
                                </div>
                                <div class="col-md-3">
                                    <label for="fecha-inicio" class="form-label">Fecha de inicio</label>
                                    <input type="date" class="form-control form-control-lg" name="fechaInicio"
                                        id="fecha-inicio"
                                        th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
                                </div>
                                <div class="col-md-3">
                                    <label for="fecha-fin" class="form-label">Fecha de fin</label>
                                    <input type="date" class="form-control form-control-lg" name="fechaFin"
                                        id="fecha-fin" th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
                                </div>
                                <div class="col-md-3">
                                    <label for="ordenar" class="form-label">Ordenar</label>
                                    <select name="sort" id="ordenar" class="form-select form-select-lg"
                                        onchange="this.form.submit()">
                                        <option value="">Seleccionar opción</option>
                                        <option value="destinoPrincipal" th:selected="${sort == 'destinoPrincipal'}">
                                            Destino</option>
                                        <!--<option value="esVerificado" th:selected="${sort == 'esVerificado'}">Verificado</option>-->
                                        <option value="fechaInicio" th:selected="${sort == 'fechaInicio'}">Más cercanos
                                        </option>
                                    </select>
                                </div>
                                <div class="text-center">
                                    <button class="btn btn-primary btn-lg px-5">
                                        <i class="bi bi-search me-2"></i>Buscar Grupos
                                    </button>
                                </div>
                            </form>
                            <div th:if="${error}" class="alert alert-danger text-center">
                                <span th:text="${error}"></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Resultados de búsqueda -->
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h3 class="fw-semibold mb-1">Grupos de viaje</h3>
                    </div>
                </div>

                <div class="row g-4">
                    <!-- Grupo -->
                    <div th:each="grupo : ${grupos}" class="col-md-6 col-lg-4">
                        <div class="card h-100 border-light hover-shadow">
                            <div class="position-relative">
                                <img th:src="@{${grupo.imagenDestacada}}" class="card-img-top"
                                    th:alt="${grupo.nombreViaje}">
                                <span class="badge bg-primary position-absolute top-0 start-0 m-2">
                                    <i class="bi bi-geo-alt me-1"></i>
                                    <span th:text="${grupo.destinoPrincipal}">Destino</span>
                                </span>
                                <!--<span th:if="${grupo.esVerificado == true}"
                                    class="badge bg-success position-absolute top-0 end-0 m-2">
                                    <i class="bi bi-check-circle me-1"></i>Verificado
                                </span>
                                <span th:if="${grupo.esVerificado == false}"
                                    class="badge bg-danger position-absolute top-0 end-0 m-2">
                                    <i class="bi bi-x-circle me-1"></i>No verificado
                                </span>-->
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="card-title fw-bold" th:text="${grupo.nombreViaje}">Nombre Viaje</h5>
                                </div>
                                <div class="d-flex align-items-center text-muted mb-2">
                                    <i class="bi bi-calendar me-2 text-primary"></i>
                                    <small>
                                        <span class="fw-medium">Inicio:</span>
                                        <span th:text="${#temporals.format(grupo.fechaInicio, 'dd MMM yyyy')}">Fecha
                                            Inicio</span>
                                        •
                                        <span class="fw-medium">Fin:</span>
                                        <span th:text="${#temporals.format(grupo.fechaFin, 'dd MMM yyyy')}">Fecha
                                            Fin</span>
                                    </small>
                                </div>
                                <div class="d-flex align-items-center text-muted mb-2">
                                    <i class="bi bi-people me-2 text-primary"></i>
                                    <small>
                                        <span class="fw-medium">Edad:</span>
                                        <span th:text="${grupo.rangoEdadMin}">Edad Min</span>-<span
                                            th:text="${grupo.rangoEdadMax}">Edad Max</span>
                                    </small>
                                </div>
                                <p class="card-text text-muted small mb-3" th:text="${grupo.descripcion}">Descripción
                                </p>
                                <a th:href="@{/mis-viajes/{id}(id=${grupo.idGrupo})}" class="btn btn-primary w-100">
                                    Ver detalles <i class="bi bi-chevron-right ms-1"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div th:if="${grupos.isEmpty()}" class="alert alert-info text-center my-5">
                    <i class="bi bi-info-circle-fill me-2"></i>
                    No se encontraron grupos de viaje.
                </div>

                <!-- Paginación -->
                <div class="d-flex justify-content-center mt-5" th:if="${totalPages > 1}">
                    <nav aria-label="Paginación de resultados">
                        <ul class="pagination">
                            <!--Botón anterior-->
                            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                                <a class="page-link"
                                    th:href="@{/buscar-grupos(destinoPrincipal=${param.destinoPrincipal}, fechaInicio=${param.fechaInicio}, fechaFin=${param.fechaFin}, sort=${sort}, page=${currentPage - 1}, size=${size})}"
                                    aria-label="Anterior">
                                    <span aria-hidden="true"><i class="bi bi-chevron-left"></i></span>
                                </a>
                            </li>
                            <!--Números de paginas-->
                            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                th:classappend="${i == currentPage} ? 'active'">
                                <a class="page-link"
                                    th:href="@{/buscar-grupos(destinoPrincipal=${param.destinoPrincipal}, fechaInicio=${param.fechaInicio}, fechaFin=${param.fechaFin}, sort=${sort}, page=${i}, size=${size})}"
                                    th:text="${i+1}">1</a>
                            </li>
                            <!--Botón siguiente-->
                            <li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
                                <a class="page-link"
                                    th:href="@{/buscar-grupos(destinoPrincipal=${param.destinoPrincipal}, fechaInicio=${param.fechaInicio}, fechaFin=${param.fechaFin}, sort=${sort}, page=${currentPage + 1}, size=${size})}"
                                    aria-label="Anterior">
                                    <span aria-hidden="true"><i class="bi bi-chevron-right"></i></span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </main>

    <script></script>
    
</body>

</html>